<!-- 記事タイトル -->
<!-- ステップ３階層ベイズモデルで、チーム毎の個体差を見たい-->
# 始めに
卓球競技の団体戦において、「ダブルスが重要である」「ダブルスが団体戦の鍵をにぎる」と経験知としてよく言われます。
学生時代等に卓球に打ち込んだ方々は、顧問の先生やクラブチームのコーチから言われたことがある人も少なくないのではないでしょうか。
かくいう私も学生時代に卓球に夢中になった者の一人ですが、色んな方々から言われた覚えがあるので、卓球界においてある種の暗黙知として存在するような気がします。

そこで、統計的因果推論を用いて「卓球団体戦におけるダブルスの勝敗」と「団体戦の勝敗」の因果関係の定量分析を試みます。
もう少し統計的因果推論の用語を用いると、本記事の目的は、「卓球団体戦におけるダブルスの勝敗(=原因変数)」が「団体戦の勝敗(=結果変数)」に与える因果効果(介入効果)の定量化、になります。

以前Twitterで、高校時代の先輩が「『卓球の団体戦はダブルスを取った方が有利』って説、誰か定量的に分析してくれないかなー」みたいな事を言っていたような気もするので、まあ需要もゼロではないんじゃないでしょうか？笑

自身の統計的因果推論の練習を兼ねてますので、見識がある方からのツッコミは歓迎しております！
また私同様に、卓球が好きな方からのコメント・ツッコミも歓迎しております！
この記事は○○の続きになりますが、「分析パートだけ見ればいいや！」って方は前記事を読まなくても理解に支障ありません！

# 回帰モデルを用いた統計的因果推論
# Bayesian Approachによる階層型の回帰モデルで、チーム毎の因果効果の個体差を考慮する.
$$ y_i \sim  Bernouli_{y_i}(\lambda_i) \\
\lambda_i = g(Q_i) = sigmoid(Q_i)\\
Q_i = \beta_{team}^T X_i \\
\beta_{j, team} = \beta_{j, 0} + \beta_{team-dif}\\
\beta_{j, team-dif} \sim Norm(0, \sigma_{\beta_j})$$
ここで、
- $y_i$：ある団体戦iにおける、団体戦の勝敗(1=ホームチームWin、0=ホームチームLose). ベルヌーイ分布に従う確率的事象。
  - (**ざっくりいうと、団体戦の勝敗を、コイントスの様な、確率的に結果が変わり得るイベントとみなしてます！**)
- $\lambda_i$：$y_i$が従う確率分布の形を決定する値(確率分布のパラメータ)。
  - （**コイントスにおける"表のでやすさ"に該当します。例えば、理想的なコインは$\lambda=0.5$、表が出やすいイカサマコインは$\lambda=0.9$等になります！**）
- $g(Q_i) = sigmoid(Q_i)$："リンク関数。
  - 一般線形回帰モデルを、正規分布以外の確率変数(ex. 離散変数、上限or下限がある変数, etc.)に従う目的変数に対応させる為の、**変換器**のようなもの。
  - ベルヌーイ分布におけるパラメータ$\lambda_i$は0~1の連続値なので、シグモイド関数をリンク関数として用いている。
  - また、$Q_i$は線形回帰の成分。
- $X_i$：ある団体戦iにおける、説明変数群のベクトル。
  - なお本記事では基本的には、"ダブルスの勝敗"、"ホームチームのSランク選手割合"、"アウェイチームのSランク選手割合"の3つを説明変数として用います！
- $\beta_{team}$：偏回帰係数ベクトル。
  - 本モデルにおいて、$y_i$と$X_i$の関係性を評価する為に、観測値から推定したい値になります。
  - また、前回の記事では、「全ての団体戦iにおいて、$y_i$と$X_i$の関係性は等しい」と仮定していました。
  - 一方で今回は、「$y_i$と$X_i$の関係性の向きや強さは、対戦チームによって個体差がある」すなわち「$\beta_{team}$が、その団体戦の対戦チームによって異なる」と仮定しています。
- $\beta_{0}と\beta_{team-dif}$：$\beta_{team}$が、共通部分$\beta_{0}$と個体差$\beta_{team-dif}$の和で表されると仮定。
  - また、その個体差は、平均０の正規分布に従って発生すると仮定。
  - (個体差が全チーム平均よりも、プラス側に寄っているチームと、マイナス側に寄っているチームが同じ数くらいある、と仮定している.)

またちなみに、ベイジアンアプローチによるモデリングでは、モデルの構造(実際に観測されるデータの生成過程?)を視覚的な図として表した、"グラフィカルモデル"がよく用いられます。
上述したモデルのグラフィカルモデルは、以下のようになります。

# まとめ
今回はステップ3として、●●によって、**●●**を試みました。
結果として、**●●**となりました。
この結果は、●●を考慮した事で明らかになりました。

次回以降はまだ未定ですが、"回帰モデルによる因果推論"の発展として階層型の回帰モデルを用いて、「ダブルスの勝敗」の因果効果の「Tリーグの各チームにおける個体差」みたいなところを定量化してみたいなと思っています。
(このチームは特にダブルス大事！このチームはダブルスの重要性低い、みたいな事が定量評価できれば、より意思決定に繋がる分析になる気がします：）)
その後は、他の統計的因果推論の手法を試してみたいですね！(傾向スコアマッチングとか！機械学習を使った手法とか！)

2回目の投稿という事で、文章的にもMarkdownの構成的にも、稚拙な点が多々あるとは思いますが、**最後までお読みいただきありがとうございました！**

繰り返しになりますが自身の**統計的因果推論やコーディングの練習**を兼ねてますので、**上記分野が好きな方々からツッコミ・コメントをいただけたらとても喜びます**！
また私同様に、**卓球が好きな方からのコメント・ツッコミもいただけたらとても嬉しいです**！

